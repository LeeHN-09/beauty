<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css"
      rel="stylesheet"
    />

    <title>角色換裝</title>

    <!-- Bootstrap core CSS -->
    <link href="/elf/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="/elf/css/dress-up.css" />
    <link rel="stylesheet" href="/elf/css/fontawesome.css" />
    <link rel="stylesheet" href="/elf/css/sidebar.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/swiper@7/swiper-bundle.min.css"
    />
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Font -->
    <!-- English -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <!-- Chinese -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <style>
      .noto-sans-tc {
        font-family: "Noto Sans TC", sans-serif;
        font-optical-sizing: auto;
        font-weight: 400;
        font-style: normal;
      }
      * {
        font-family: "Noto Sans TC", sans-serif;
      }

      /* 自定義樣式 */
      .navbar-brand img {
        width: 40px;
        /* 調整頭像寬度 */
        height: 40px;
        /* 調整頭像高度 */
        border-radius: 50%;
        /* 讓頭像呈圓形 */
        margin-right: 10px;
        /* 調整頭像與 bx-menu 圖標之間的間距 */
      }

      .bx-menu {
        font-size: 24px;
        /* 調整 bx-menu 圖標大小 */
      }

      .container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background-color: #f5f5f5;
        border-radius: 10px;
      }

      /* Dress-up grid  */
      .d-wrapper {
        display: grid;
        grid-gap: 10px;
        grid-template-columns: 4;
        grid-template-rows: 3;
        padding: 30px;
      }

      .d-box {
        color: #fff;
        border-radius: 5px;

        padding: 20px;
        font-size: 150%;
        text-align: center;
      }

      .fadein img {
        opacity: 0.7;
        transition: 0.5s ease;
      }

      .fadein img:hover {
        opacity: 1;
        transition: 0.8s ease;
      }

      /* grid-column: x / y;grid-row: x / y */

      .item-a {
        background-color: #ffffff;
        grid-column: 1/2;
        grid-row: 1/2;
      }

      .item-b {
        background-color: #ffffff;
        grid-column: 2/3;
        grid-row: 1/2;
      }

      .item-c {
        background-color: #ffffff;
        grid-column: 3 / 4;
        grid-row: 1 / 2;
      }

      .item-d {
        background-color: #ffffff;
        grid-column: 4 / 5;
        grid-row: 1 / 2;
      }

      .item-e {
        background-color: #ffffff;
        grid-column: 1 / 2;
        grid-row: 2 / 3;
      }

      .item-f {
        background-color: #ffffff;
        grid-column: 2 / 3;
        grid-row: 2 / 3;
      }

      .item-g {
        background-color: #ffffff;
        grid-column: 3 / 4;
        grid-row: 2 / 3;
      }

      .item-h {
        background-color: #ffffff;
        grid-column: 4 / 5;
        grid-row: 2 / 3;
      }

      .item-i {
        background-color: #ffffff;
        grid-column: 1 / 2;
        grid-row: 3 / 4;
      }

      .item-j {
        background-color: #ffffff;
        grid-column: 2 / 3;
        grid-row: 3 / 4;
      }

      .item-k {
        background-color: #ffffff;
        grid-column: 3 / 4;
        grid-row: 3 / 4;
      }

      .item-l {
        background-color: #ffffff;
        grid-column: 4 / 5;
        grid-row: 3 / 4;
      }

      /* card */
      .card-wrapper {
      	margin-top: 70px;
      	/* 為上方邊界留出空間 */
        width: calc(100% - 250px);
        margin-left: 100px;
        /* 為側選單留出空間 */
      }

      .card {
        width: 300px;
        /* 設定卡片寬度 */
        float: left;
        /* 讓卡片橫向排列 */
        margin-right: 20px;
        /* 設定卡片間距 */
        transition: transform 0.5s ease;
        /* 添加滑動效果 */
      }

      .card:hover {
        transform: scale(1.1);
        /* 滑鼠懸停時放大卡片 */
      }

      .pic img {
        width: 100%;
        height: auto;
      }

      .card-header,
      .card-body,
      .card-footer {
        padding: 10px;
        background-color: #f0f0f0;
      }

      .c-btn {
        margin-left: 30px;
      }

      /* 圖片替換 */
      #characterBlock {
        width: 300px; /* 設置容器的寬度 */
        height: 300px; /* 設置容器的高度 */
        overflow: hidden; /* 確保內容不會溢出容器 */
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .character-img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* 確保圖片填滿容器且不會變形 */
      }
    </style>
  </head>

  <body
    style="
      background: linear-gradient(
        to right,
        rgb(246, 222, 136) 20%,
        rgb(242, 128, 128) 80%
      );
    "
    class="noto-sans-tc-regular"
  >
     <div class="wrapper">
    <!-- 側邊欄開始 -->
    <aside id="sidebar">
        <div class="d-flex">
            <!-- 切換按鈕 -->
            <button class="toggle-btn" type="button">
                <i class="fas fa-bars"></i>
            </button>
            <!-- 側邊欄標誌 -->
            <div class="sidebar-logo">
                <a href="#">B&B</a>
            </div>
        </div>
		<!-- 側邊欄導航 -->
		       <ul class="sidebar-nav">

		           <li class="sidebar-item">
		               <a href="#" class="sidebar-link">
		                   <img src="/elf/icon/nav_home.ico" class="icon-type">
		                   <span>首頁</span>
		               </a>
		           </li>
		<!-- 單個導航項目 -->
		            <li class="sidebar-item">
		              <a href="/memberindex" class="sidebar-link collapsed has-dropdown" data-bs-toggle="collapse"
		                  data-bs-target="#member" aria-expanded="false" aria-controls="member">
		                  <img src="/elf/icon/feature04.ico" class="icon-type">
		                  <span>會員中心</span>
		              </a>
		              <ul id="member" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#sidebar">
		                  <li class="sidebar-item">
		                      <a href="/memberindex" class="sidebar-link sidebar-text">個人資訊</a>
		                  </li>
		                  <li class="sidebar-item">
		                      <a href="/membergoal" class="sidebar-link sidebar-text">健康目標</a>
		                  </li>
		                  <li class="sidebar-item">
		                    <a href="/memberreport" class="sidebar-link sidebar-text">個人健康報表</a>
		                </li>
		              </ul>
		          </li>

		            <!-- 嵌套導航項目 -->
		            <li class="sidebar-item">
		                <a href="/elves" class="sidebar-link">
		                    <img src="/elf/icon/nav_mushrooms.ico" class="icon-type">
		                    <span>健身精靈</span>
		                </a>
		            </li>
		            <!-- 具有下拉菜單的導航項目 -->
		            <li class="sidebar-item">
		                <a href="#" class="sidebar-link collapsed has-dropdown" data-bs-toggle="collapse"
		                    data-bs-target="#auth" aria-expanded="false" aria-controls="auth">
		                    <img src="/elf/icon/feature03.ico" class="icon-type">
		                    <span>我的計畫</span>
		                </a>
		                <ul id="auth" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#sidebar">
		                    <li class="sidebar-item">
		                        <a href="/api/caloriesPage" class="sidebar-link sidebar-text">運動計畫</a>
		                    </li>
		                    <li class="sidebar-item">
		                        <a href="/eat/eatcalories" class="sidebar-link sidebar-text">飲食紀錄</a>
		                    </li>
		                </ul>
		            </li>

		            <!-- 其他導航項目 -->
		            <li class="sidebar-item">
		                <a href="/shop" class="sidebar-link">
		                    <img src="/elf/icon/nav_buy.ico" class="icon-type">
		                    <span>健身好物</span>
		                </a>
		            </li>

		        </ul>
        <!-- 側邊欄底部 -->
        <div class="sidebar-footer">
            <a href="#" class="sidebar-link">
                <img src="/elf/icon/nav_logout.ico" class="icon-type">
                <span>登出</span>
            </a>
        </div>
    </aside>
    <!-- character card -->
    <div class="card-wrapper">
      <div class="card">
        <div class="clash-card barbarian">
          <div
            id="characterBlock"
            class="clash-card__image clash-card__image--barbarian"
          >
            <img id="character-image-1" src="" />
          </div>
          <div class="clash-card__unit-name" id="elfName">
          </div>
          <div class="clash-card__unit-description">
            <h2 id="character-name-1"></h2><br><br>
            <button class="btn c-btn btn-dark" id="confirmButton">
              <i class="fa-solid fa-rotate-right"></i>
              復原
            </button>
            <button class="btn c-btn btn-danger" onclick="saveAccessoryId()">
              <i class="fa-solid fa-heart"></i>
              儲存
            </button>
          </div>
        </div>
        <!-- end clash-card barbarian-->
      </div>
      <!-- end wrapper -->

      <!-- 主內容: 角色選色 -->
      <div class="features noto-sans-tc-regular card-maintain">
        <!-- <div class="row"> -->
        <!-- 恢復預設值按鈕 -->
        <div class="col-md-6">
          <!-- 套裝區塊 -->
          <div class="d-wrapper fadein list-group" id="hatImage">
            <div class="d-box item-a">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/27.png',27)"
                ><img src="/elf/images/1.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-b">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/28.png',28)"
                ><img src="/elf/images/2.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-c">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/29.png',29)"
                ><img src="/elf/images/3.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-d">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/30.png',30)"
                ><img src="/elf/images/4.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-e">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/31.png',31)"
                ><img src="/elf/images/5.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-f">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/32.png',32)"
                ><img src="/elf/images/6.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-g">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/33.png',33)"
                ><img src="/elf/images/7.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-h">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/34.png',34)"
                ><img src="/elf/images/8.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-i">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/35.png',35)"
                ><img src="/elf/images/9.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-j">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/36.png',36)"
                ><img src="/elf/images/10.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-k">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/37.png',37)"
                ><img src="/elf/images/11.png" alt="" width="100px"
              /></a>
            </div>
            <div class="d-box item-l">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                onclick="changeitems('/elf/images/38.png',38)"
                ><img src="/elf/images/12.png" alt="" width="100px"
              /></a>
            </div>
            <!-- Add more d-box items here -->
          </div>
      </div>
    </div>

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://assets.codepen.io/11614/iro.min.js"></script>
    <script src="/elf/js/script.js"></script>
    <script>

      //api:獲取初始精靈圖片跟名稱

      $(document).ready(function () {
    console.log("Document ready!");

    // 从 sessionStorage 获取登录信息
    const userId = sessionStorage.getItem("loginId");
    console.log(userId); // 打印 userId，用于调试

    // 如果 userId 为空，提示重新登录
    if (!userId) {
        alert("未找到用户ID，请重新登录。");
        return;
    }

    // 构建后端 API 请求地址
    const apiUrl = `/api/elves/${userId}`;
    console.log(apiUrl)
    // 发送 GET 请求获取精灵数据
    $.ajax({
        url: apiUrl,
        type: "GET",
        success: function (response) {
            console.log("Response from server:", response);

            // 根据响应设置精灵图片
            if (response) {
            	$("#character-image-1").attr("src", "data:image/png;base64," + response);
            }

            // 设置精灵名字
            
        },
        error: function (xhr, status, error) {
            console.error("Error fetching data:", error); // 输出详细的错误信息到控制台
            alert("获取用户的精灵数据失败，请稍后再试。");
        }
    });
});


      // 更換圖片
      // 只有let 跟 var可以  const不行
		let accessoryId = null;
      function changeitems(imageSrc,id) {
        var characterBlock = document.getElementById("characterBlock");
        characterBlock.innerHTML =
          '<img src="' + imageSrc + '" alt="角色" class="character-img">';
        accessoryId = id;
        console.log(accessoryId);
      }
	
   // 儲存配件ID到後端
      window.saveAccessoryId = function() {
    	  const userId = sessionStorage.getItem("loginId");
	   
    if (accessoryId !== null) {
      fetch(`/api/saveAccessoryId`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ user_id: userId, accessory_id: accessoryId })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('配件已儲存');
        } else {
          alert('儲存失敗');
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
    } else {
      alert('請先選擇一個配件');
    }
  };


    </script>
  </body>
</html>