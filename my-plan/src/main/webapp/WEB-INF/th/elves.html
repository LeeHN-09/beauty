<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css"
      rel="stylesheet"
    />

    <title>角色換裝</title>
    <!-- 引入 LineIcons 字體庫 -->
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Bootstrap core CSS -->
    <link href="/elf/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="/elf/css/dress-up.css" />
    <link rel="stylesheet" href="/elf/css/fontawesome.css" />
    <link rel="stylesheet" href="/elf/css/sidebar.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/swiper@7/swiper-bundle.min.css"
    />

    <!-- Google Font -->
    <!-- English -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    
    <!-- Chinese -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap"
      rel="stylesheet"
    />

    <style>
      .noto-sans-tc {
        font-family: "Noto Sans TC", sans-serif;
        font-optical-sizing: auto;
        font-weight: 400;
        font-style: normal;
      }
      * {
        font-family: "Noto Sans TC", sans-serif;
      }

      /* 自定義樣式 */
      .navbar-brand img {
        width: 40px;
        /* 調整頭像寬度 */
        height: 40px;
        /* 調整頭像高度 */
        border-radius: 50%;
        /* 讓頭像呈圓形 */
        margin-right: 10px;
        /* 調整頭像與 bx-menu 圖標之間的間距 */
      }

      .bx-menu {
        font-size: 24px;
        /* 調整 bx-menu 圖標大小 */
      }

      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@200;600&display=swap");

      .c-body {
        display: grid;
        font-family: "Poppins", sans-serif;
        height: 100vh;
        margin: 0;
        place-items: center;
      }

      .viewport {
        display: flex;
        justify-content: center;
        overflow: hidden;
        width: 100%;
        gap: 20px;
        margin-left: 50px;
        margin-top: 100px;
      }

      .character-card {
        cursor: pointer;
        height: 420px;
        padding-top: 40px;
        position: relative;
        overflow-y: visible;
        width: 220px;
      }

      .character-card__container {
        /*   background: pink; 2 -1 */
        background-image: linear-gradient(
          to right top,
          #263d62,
          #2a507b,
          #2a6595,
          #267baf,
          #1791c8
        );
        border-radius: 30px;
        /*   bottom: 0; 3 ---- */
        height: 160px;
        position: absolute;
        top: 220px;
        /* 3 */
        transform: scale(1);
        /* 3 */
        width: 220px;

        /* 3 */
        transition: top 1s ease-in-out, 1s transform 1s ease-in-out;
      }

      .character-card__content {
        /*   background: rgba(0, 0, 0, 0.2); 2 - 1 */
        height: 340px;
        /* 1 - 4 */
        position: absolute;
        transform: translateY(30px);
        /* After widths & margins*/
        width: 100%;
        /* 1 - 3 */

        transition: transform 0.3s ease-in-out;
      }

      .character-card__content:hover {
        transform: translateY(0px);
        transition: transform 0.3s ease-in-out;
      }

      .character-card__content--image {
        /* 1 - 6 */
        left: -30px;
        bottom: 100px;
        position: absolute;
        width: 275px;
        transform: scale(1);
        transform-origin: bottom;
        transition: transform 0.3s ease-in-out;
      }

      .character-card__content:hover .character-card__content--image {
        transform: scale(1.2);
        transform-origin: bottom;
        transition: transform 0.3s ease-in-out;
      }

      .character-card__content--text {
        /* 1 - 5 */
        bottom: 0;
        left: 30px;
        position: absolute;
      }

      .character-card__content--text h2 {
        color: #ade2f2;
        /* 2 - 2 */
        font-size: 20px;
        /* 2 - 3 */
        margin: 5px 0 0;
      }

      .character-card__content--text p {
        color: rgba(255, 255, 255, 0.5);
        /* 2 - 2 */
        font-size: 12px;
        /* 2 - 3 */
        margin: 0 0 12px 0;
      }

      .character-card__content--text span {
        color: white;
        /* 2 - 2 */
      }

      /* 6 */
      .character-card__content--description {
        color: white;
        font-size: 12px;
        height: 50px;
        left: 240px;
        /* 5 */
        opacity: 0;
        overflow: hidden;
        position: absolute;
        top: 150px;
        width: 0px;
        white-space: nowrap;
        z-index: 1;
      }

      .character-card__content--description span {
        color: rgba(255, 255, 255, 0.5);
      }

      .character-card__content--text button {
        background: none;
        border: none;
        color: white;
        /* 2 - 2 */
        font-size: 12px;
        /* 2 - 3 */
        letter-spacing: 1px;
        /* 2 - 3 */
        margin: 0 0 18px;
        opacity: 0;
        padding: 0;
        text-transform: uppercase;
        /* 2 - 2 */
        transition: opacity 0.3s ease-in-out;
      }

      /* 4 */
      .character-card__content--text button:focus {
        outline: none;
      }

      .character-card__content:hover .character-card__content--text button {
        opacity: 1;
        transition: opacity 0.3s ease-in-out;
      }

      /* Styles from JS - 3 */

      /* Styles from JS - 5 */

      .pause-content {
        transform: translateY(0px);
        transition: transform 0.3s ease-in-out;
      }

      .pause-image {
        transform: scale(1.2);
        transform-origin: bottom;
        transition: transform 0.3s ease-in-out;
      }

      .remove-button {
        opacity: 0 !important;
      }

      /* Styles from JS - 6 */

      .show-description {
        animation: 0.8s show-description 0.5s ease-in-out forwards;
      }

      @keyframes show-description {
        0% {
          height: 50px;
          opacity: 0;
          width: 0;
        }

        100% {
          height: 200px;
          opacity: 1;
          width: 300px;
        }
      }

      .hide-description {
        animation: hide-description 0.5s ease-in-out forwards;
      }

      @keyframes hide-description {
        0% {
          height: 200px;
          opacity: 1;
          width: 300px;
        }

        100% {
          height: 50px;
          opacity: 0;
          width: 0;
        }
      }

      /* social buttons */
      .able-btn {
        display: inline-block;
        color: black;
        border: 2px outset rgba(0, 0, 0, 0.9);
        background: #fff;
        /* text-shadow: 1px 1px 1px rgba(0, 0, 0, 20); */
        box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.5);
        letter-spacing: 3px;
        transition: 0.2s;
      }

      .able-btn:hover {
        color: #fff;
        border: 2px outset rgba(243, 33, 33, 0.9);
        background: rgba(241, 11, 11, 0.9);
        transform: scale(1.1);
        transition: 0.2s;
        /* text-shadow: 1px 1px 1px rgba(0, 0, 0, 20); */
        box-shadow: 1px 1px 1px rgba(245, 57, 57, 0.855);
        letter-spacing: 3px;
      }

      .disable-btn {
        display: inline-block;
        color: black;
        border: 2px outset rgba(0, 0, 0, 0.9);
        background: #fff;
        /* text-shadow: 1px 1px 1px rgba(0, 0, 0, 20); */
        box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.5);
        letter-spacing: 3px;
        transition: 0.2s;
      }

      .disable-btn:hover {
        display: inline-block;
        color: black;
        border: 2px outset rgba(0, 0, 0, 0.9);
        background: #fff;
        box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.5);
        letter-spacing: 3px;
        transition: 0.2s;
      }
    </style>
  </head>

  <body
    style="
      background: linear-gradient(
        to right,
        rgb(246, 222, 136) 20%,
        rgb(242, 128, 128) 80%
      );
    "
    class="noto-sans-tc-regular"
  >
  <div class="wrapper">
    <!-- 側邊欄開始 -->
    <aside id="sidebar">
        <div class="d-flex">
            <!-- 切換按鈕 -->
            <button class="toggle-btn" type="button">
                <i class="fas fa-bars"></i>
            </button>
            <!-- 側邊欄標誌 -->
            <div class="sidebar-logo">
                <a href="#">B&B</a>
            </div>
        </div>
        <!-- 側邊欄導航 -->
        <ul class="sidebar-nav">

            <li class="sidebar-item">
                <a href="/dashboard" class="sidebar-link">
                    <img src="/elf/icon/nav_home.ico" class="icon-type">
                    <span>首頁</span>
                </a>
            </li>

            <!-- 單個導航項目 -->
            <li class="sidebar-item">
              <a href="/memberindex" class="sidebar-link collapsed has-dropdown" data-bs-toggle="collapse"
                  data-bs-target="#member" aria-expanded="false" aria-controls="member">
                  <img src="/elf/icon/feature04.ico" class="icon-type">
                  <span>會員中心</span>
              </a>
              <ul id="member" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#sidebar">
                  <li class="sidebar-item">
                      <a href="/memberindex" class="sidebar-link sidebar-text">個人資訊</a>
                  </li>
                  <li class="sidebar-item">
                    <a href="/memberreport" class="sidebar-link sidebar-text">個人健康報表</a>
                </li>
              </ul>
          </li>

            <!-- 嵌套導航項目 -->
            <li class="sidebar-item">
                <a href="/elves" class="sidebar-link">
                    <img src="/elf/icon/nav_mushrooms.ico" class="icon-type">
                    <span>健身精靈</span>
                </a>
            </li>
            <!-- 具有下拉菜單的導航項目 -->
            <li class="sidebar-item">
                <a href="#" class="sidebar-link collapsed has-dropdown" data-bs-toggle="collapse"
                    data-bs-target="#auth" aria-expanded="false" aria-controls="auth">
                    <img src="/elf/icon/feature03.ico" class="icon-type">
                    <span>我的計畫</span>
                </a>
                <ul id="auth" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#sidebar">
                    <li class="sidebar-item">
                        <a href="/api/caloriesPage" class="sidebar-link sidebar-text">運動計畫</a>
                    </li>
                    <li class="sidebar-item">
                        <a href="/eat/eatcalories" class="sidebar-link sidebar-text">飲食紀錄</a>
                    </li>
                </ul>
            </li>

            <!-- 其他導航項目 -->
            <li class="sidebar-item">
                <a href="/shop" class="sidebar-link">
                    <img src="/elf/icon/nav_buy.ico" class="icon-type">
                    <span>健身好物</span>
                </a>
            </li>

        </ul>
        <!-- 側邊欄底部 -->
        <div class="sidebar-footer">
            <a href="#" class="sidebar-link">
                <img src="/elf/icon/nav_logout.ico" class="icon-type">
                <span>登出</span>
            </a>
        </div>
    </aside>
    <!-- Modal -->
    <!-- 可用的角色彈窗提示 -->
    <div  class="modal fade"
      id="exampleModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">通知:設定變更</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">你的精靈角色已變更成功!</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="confirmButton">
              確定
            </button>
          </div>
        </div>
      </div>
	</div>
      <!-- dressup2 -->
       <!-- Modal -->
    <!-- 可用的角色彈窗提示 -->
    <div
    class="modal fade"
    id="exampleModal2"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">通知:設定變更2</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">你的精靈角色2已變更成功!</div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="confirmButton2">
            確定
          </button>
        </div>
      </div>
    </div>

      <!-- 不可用的角色彈窗提示 -->
      <div
        class="modal fade"
        id="disableModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">
                通知:角色尚未解鎖
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              精靈角色尚未解鎖，可在完成更多任務後提升精靈等級解鎖!
            </div>
            <div class="modal-footer">
              <!-- <button type="button" class="btn-secondary" data-bs-dismiss="modal">Close</button> -->
              <button
                type="button"
                class="btn btn-primary"
                data-bs-dismiss="modal"
              >
                確定
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 角色選擇 -->
    <div class="viewport">
      <section id="character-card-1" class="character-card c-body">
        <div class="character-card__container"></div>
        <div class="character-card__content">
          <img
            id="character-image-1"
            class="character-card__content--image"
            src=""
            alt="角色1"
          />
          <div class="character-card__content--text">
            <h2 id="character-name-1"></h2>
            <p>Movie <span>Inside Out</span></p>
            <button
              id="save-elf-1"
              type="button"
              class="btn able-btn btn-default btn-lg save-elf"
              data-bs-toggle="modal"
              data-bs-target="#exampleModal"
            >
              使用
            </button>
          </div>
        </div>
      </section>

      <section id="character-card-2" class="character-card c-body">
        <div class="character-card__container"></div>
        <div class="character-card__content">
          <img
            id="character-image-2"
            class="character-card__content--image"
            src=""
            alt="角色2"
          />
          <div class="character-card__content--text">
            <h2 id="character-name-2"></h2>
            <p>Movie <span>Inside Out</span></p>
            <button
              id="save-elf-2"
              type="button"
              class="btn able-btn btn-default btn-lg save-elf2"
              data-bs-toggle="modal"
              data-bs-target="#exampleModal2"
            >
              使用
            </button>
          </div>
        </div>
      </section>
      <section id="character-card-3" class="character-card c-body">
        <div class="character-card__container"></div>
        <div class="character-card__content">
          <img
            id="character-image-3"
            class="character-card__content--image"
            src=""
            alt="角色3"
          />
          <div class="character-card__content--text">
            <h2 id="character-name-3">Sadness</h2>
            <p>Movie <span>Inside Out</span></p>

            <button
              id="save-elf-3"
              type="button"
              class="btn disable-btn btn-default btn-lg save-elf"
              data-bs-toggle="modal"
              data-bs-target="#disableModal"
            >
              尚未解鎖
            </button>
          </div>
        </div>
      </section>
    </div>

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://assets.codepen.io/11614/iro.min.js"></script>
    <script src="/elf/js/script.js"></script>
    <script>
      //api
      document.addEventListener("DOMContentLoaded", function() {
      $(document).ready(function () {
        console.log("Document ready!");
    const characterCards = [
        {
            imageId: "#character-image-1",
            nameId: "#character-name-1",
            buttonId: "#save-elf-1",
        },
        {
            imageId: "#character-image-2",
            nameId: "#character-name-2",
            buttonId: "#save-elf-2",
        },
        {
            imageId: "#character-image-3",
            nameId: "#character-name-3",
            buttonId: "#save-elf-3",
        },
    ];

    let originalImageBase64 = ""; // 保存初始图片的 Base64 数据
    let userId = null; // 声明全局变量存储 userId
    
    
    // 从 SessionStorage 中获取 userId
    console.log(sessionStorage);
    const responseString = sessionStorage.getItem("loginId");
    console.log(responseString);
    if (responseString) {
        userId = JSON.parse(responseString);
        // 使用 API 获取角色数据
        $.get("/api/elftypes")
        .done(function (data) {
            data.forEach(function (elfType, index) {
                if (index < characterCards.length) {
                    var card = characterCards[index];
                    $(card.imageId).attr("src", "data:image/png;base64," + elfType.elfImage);
                    $(card.imageId).attr("alt", elfType.name);
                    $(card.nameId).text(elfType.name);
                    $(card.buttonId).data("type-id", elfType.typeId);

                    $(card.imageId).css({
                        width: "300px",
                        position: "absolute",
                    });

                    if (index === 0) {
                        originalImageBase64 = "data:image/png;base64," + elfType.elfImage;
                    }
                }
            });
        })
        .fail(function () {
            alert("获取 elftypes 数据失败，请稍后再试。");
        });
    } else {
        alert("未找到用户ID，请重新登录。");
        // 如果未找到用户ID，可以在此处处理重定向或其他逻辑
      // 点击保存角色按钮事件处理
    }
    //第一個使用
    $(".save-elf").click(function () {
      console.log("Save elf button clicked!");
        var selectedElfTypeId = $(this).data("type-id");
        console.log("Selected Elf Type ID:", selectedElfTypeId);
        console.log("User ID:", userId); // 输出当前用户ID，确保获取正确
        if (selectedElfTypeId) {
            // 发送保存选中角色的请求
            $.ajax({
                url: "/api/elves",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    typeId: selectedElfTypeId,
                    userId: userId
                }),
                success: function (response) {
                    alert("Elf saved successfully!");
                    $("#exampleModal").modal("hide");
                },
                error: function (xhr, status, error) {
                    alert("Failed to save elf: " + xhr.responseText);
                },
            });
        } else {
            alert("Please select an elf.");
        }
    });
    //第二個使用
    $(".save-elf2").click(function () {
      console.log("Save elf button2 clicked!");
        var selectedElfTypeId = $(this).data("type-id");
        console.log("Selected Elf2 Type ID:", selectedElfTypeId);
        console.log("User ID:", userId); // 输出当前用户ID，确保获取正确
        if (selectedElfTypeId) {
            // 发送保存选中角色的请求
            $.ajax({
                url: "/api/elves",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    typeId: selectedElfTypeId,
                    userId: userId
                }),
                success: function (response) {
                    alert("Elf saved successfully!");
                    $("#exampleModal2").modal("hide");
                },
                error: function (xhr, status, error) {
                    alert("Failed to save elf: " + xhr.responseText);
                },
            });
        } else {
            alert("Please select an elf.");
        }
    });
    });
  });

    // 确认按钮点击事件处理
    $("#confirmButton").click(function () {
        window.location.href = "/dressup"; // 跳转到 /dressup
    });
    $("#confirmButton2").click(function () {
        window.location.href = "/dressup2"; // 跳转到 /dressup
    });
    // Modal
    $(".button").click(function () {
        var buttonId = $(this).attr("id");
        $("#modal-container").removeAttr("class").addClass(buttonId);
        $("body").addClass("modal-active");
      });

      $("#modal-container").click(function () {
        $(this).addClass("out");
        $("body").removeClass("modal-active");
      });


    </script>
  </body>
</html>
